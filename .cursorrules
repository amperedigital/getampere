# Project Instructions

## Critical Technical Constraints
- **WSL File Sync Bug**: The workspace environment (WSL) has a bug where standard file editing tools (`read_file`, `create_file`, `replace_string_in_file`) fail with a "File Too Large" error for certain files (specifically `deploy/assets/js/tab-flipper.js`).
- **Mandatory Workaround**: You **MUST** use terminal commands (`cat`, `sed`, `rm`, `echo`, heredocs) to read or write to `deploy/assets/js/tab-flipper.js`.
  - **Reading**: Use `cat deploy/assets/js/tab-flipper.js`.
  - **Writing**: Use `cat << 'EOF' > deploy/assets/js/tab-flipper.js` (ensure you `rm` the file first if overwriting completely to be safe).
  - **Formatting**: When using `cat << 'EOF'`, do **NOT** escape backticks or template literals (`${}`) in the content. The single quotes around 'EOF' prevent shell expansion. Unnecessary escaping will break the code.
  - **Do NOT** use the standard edit tools for this file.
- **Safe Editing Tools**:
  - **Structure/Blocks**: Use `python3 scripts/safe_replace_html.py "file" "target_id" "content"` when replacing entire HTML elements with IDs. This guarantees tag balance.
  - **Surgical/Text**: Use `python3 scripts/smart_replace.py "file" "old.txt" "new.txt"` for edits without IDs. This prevents accidental mass deletion (safety tripwire > 15 lines).
  - **Standard**: Use `replace_string_in_file` ONLY for small, unique changes < 5 lines.

- **Tool Priorities**:
  - **Searching**: Always prefer the `grep_search` tool over running `grep` manually in the terminal. The tool provides better structured output and is less prone to shell escaping errors.

## Deployment Workflow (Strict)
- **Source of Truth**: The `deploy/` folder is the only source for deployment.
- **CDN Usage**: Production HTML (`deploy/index.html`) MUST use jsDelivr CDN links for all scripts.
- **Dual-Publish Rule**: If you touch both Frontend and Backend, you MUST run **BOTH** publish scripts.
  - **Frontend**: `./scripts/publish.sh vX.Y.Z`
  - **Backend**: `../getampere-antigravity-backend/memory-api/scripts/publish.sh vX.Y.Z`
- **Variable Naming (MANDATORY)**: Always use `user_time_greeting` (snake_case). Never use camelCase for ElevenLabs variables in this environment.
- **Process**:
  1. Edit local files in `deploy/`.
  2. **STOP**: Do NOT manually commit, tag, or edit `index.html` versions.
  3. **EXECUTE**: Run the publish script: `./scripts/publish.sh vX.Y.Z`
  4. **VERIFY**: Check the output and verify the CDN is live.

## General Rules
- **MANDATORY**: You MUST read the file `context.md` at the very beginning of every session to understand the project architecture and rules. Do not proceed without reading it.
- **Context Maintenance**: When updating `context.md` with new rules or components:
  - **Identify Location**: Do NOT blindly append to the end of the file. Place new content in its relevant section (e.g., Components in Section 5/6, Design Rules in Section 7).
  - **Maintain Structure**: Preserve numbering and formatting.
- **NO TOUCHING**: Never modify or retag files that you have not explicitly edited.
- **CONTENT PRESERVATION**: NEVER change content (text, copy, headings) given by the user unless explicitly requested. If you are refactoring code, you MUST preserve the original text exactly.

## Code Quality & Architecture (Strict)
- **NO INLINE SCRIPTS**: Do NOT add `<script>...</script>` blocks with logic to HTML files. All logic must reside in `global.js` or dedicated module files (e.g., `hero-slider.js`).
- **DRY PRINCIPLE**: Before adding new listeners (IntersectionObserver, Scroll, Click), check `global.js`. Extend existing observers rather than creating duplicates.
- **NO SHOTGUN APPROACH**: Do not "guess" or add redundant fixes. Analyze the existing `global.js` or component logic first. If a feature exists globally, use it.
- **MODULARITY**: Features should be modular. If you are creating a new component, it should likely be a new ES module in `deploy/assets/js/` that is imported or lazy-loaded, not dumped into `index.html`.

## Design Guidelines (Directive)
- **Room to Breathe**: All UI layouts (especially headers, hero sections, and cards) MUST have substantial internal padding. Never "jam" content against container edges. Elements should frame the content, not suffocate it.
- **Responsive Insets**:
  - **Mobile**: Use meaningful insets (e.g., `inset-8` or `p-8`) to distinguish content from the device bezel.
  - **Desktop**: Scale up proportionally (e.g., `inset-12`).
  - **Avoid**: Small padding values like `p-2` or `p-4` for major layout containers.
- **Animated Status Pill (Strict)**:
  - **Component**: See `context.md` for the canonical HTML markup (Blue Pulse Dot + Mono Text).
  - **Placement Rules**:
    - **Mobile**: Center strictly (`left-1/2 -translate-x-1/2`).
    - **Desktop**: "Straddle" the container border.
      - Vertical: EXACT center on line (`top-[inset] -translate-y-1/2`).
      - Horizontal: Inset from edge (`right-[inset + 2rem]`). NEVER flush align.
- **Responsive Layout Safety (Strict)**:
  - **Compact Class**: For the 820px-1024px range, you MUST use the "Universal Compact" approach (Mobile UI, Desktop Width). Do not use `orientation` queries to split this range.
  - **Shift Math**: NEVER apply `left/right` offsets to a `w-full` element without adding a compensating `width: calc(...)`. 
  - **Verticality**: Avoid `height: 100vh` on complex layouts. Use `min-height: 100vh` to prevent vertical clipping on short screens.
